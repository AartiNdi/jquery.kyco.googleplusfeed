// jquery.kyco.googleplusfeed brought to you by www.kyco.co.za. Copyright 2013 Cornelius Weidmann. Distributed under the GPL.
(function(a){var h={init:function(e){var b=a.extend({},{feedLoaderClass:"feed_loader",feedWrapperClass:"feed_wrapper",feedHeaderClass:"feed_header",feedScreenNameClass:"feed_screen_name",feedProfileImageClass:"feed_profile_image",feedContentClass:"feed_content",feedPostsContentClass:"feed_post",feedShowMoreClass:"feed_sow_more",feedPosts:3,feedIncrement:3,feedMax:20,imgSize:50},e);return this.each(function(){function e(){var a=l.entries,d=a.length,m=0,f=!1,g=0,k=b.feedPosts,c="";if(0<a.length){for(g;g< b.feedPosts;g++)c+='<div class="'+b.feedPostsContentClass+" post_"+(g+1)+'">',c+="<span>Shared publicly - "+a[g].publishedDate.substr(0,16)+"</span>",c+="<p>"+a[g].contentSnippet+"</p>",c+='<a href="'+a[g].link+'" target="_blank">View post</a>',c+="</div>";s.html('<a href="'+l.url+'" target="_blank">'+l.screenName+"</a>");r.attr("href",l.url);r.append('<img src="'+l.image+'" />');n.html(c);n.animate({scrollTop:0},1);p.fadeIn(300);q.click(function(){if(m<=d){m+=f?b.feedIncrement:b.feedPosts+b.feedIncrement; m=m>d?d:m;for(k;k<m;k++)c+='<div class="'+b.feedPostsContentClass+" post_"+(k+1)+'">',c+="<span>Shared publicly - "+a[k].publishedDate.substr(0,16)+"</span>",c+="<p>"+a[k].contentSnippet+"</p>",c+='<a href="'+a[k].link+'" target="_blank">View post</a>',c+="</div>",k===d-1&&(q.unbind("click").addClass("link"),q.text("View more posts on Google+").click(function(){window.open(l.url)}));n.animate({scrollTop:n[0].scrollHeight},500);f=!0}n.html(c)})}else g="Nothing to show."+l.screenName+" has an empty feed.", console.log(g),n.html(g)}var f=a(this),t=a('<div id="feed_for_'+f.attr("class")+'"class="kyco_googleplusfeed"></div>'),h=a('<div class="'+b.feedLoaderClass+'">Loading...</div>'),p=a('<div class="'+b.feedWrapperClass+'"></div>'),u=a('<div class="'+b.feedHeaderClass+'"></div>'),s=a('<h3 class="'+b.feedScreenNameClass+'"></h3>'),r=a('<a href="#" class="'+b.feedProfileImageClass+'" target="_blank"></a>'),n=a('<div class="'+b.feedContentClass+'"></div>'),q=a('<span class="'+b.feedShowMoreClass+'">Show more</span>'); u.append(r,s);p.append(u,n,q);t.append(h,p);f.append(t);var l=new function(f){var d=this;d.id=f;d.image="https://plus.google.com/s2/photos/profile/"+d.id+"?sz="+b.imgSize;d.url="https://plus.google.com/"+d.id;d.init=function(){e()};a.ajax({url:"http://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num="+b.feedMax+"&callback=?&q="+encodeURIComponent("http://plusfeed.frosas.net/"+d.id),dataType:"json",success:function(b){try{var f=b.responseData.feed.title;d.screenName=f.substr(0,f.indexOf("@")- 1);d.entries=b.responseData.feed.entries;d.entries.forEach(function(b){b.contentSnippet=a(b.content).first().html()});d.raw=b;a('<img src="'+d.image+'"/>').load(function(){h.fadeOut(300,function(){a(this).remove();d.init()})})}catch(e){console.log("There was an error retrieving the feed contents.",e),h.fadeOut(300,function(){a(this).remove();p.fadeIn(300);p.html("There was an error retrieving the feed contents.")})}}})}(b.id)})}};a.fn.kycoGooglePlusFeed=function(e){"forEach"in Array.prototype||(Array.prototype.forEach= function(a,e){for(var f=0,h=this.length;f<h;f++)f in this&&a.call(e,this[f],f,this)});"string"===typeof e&&(e={id:e});if(h[e])return h[e].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof e&&e)a.error("Method "+e+" does not exist on jQuery.kycoGooglePlusFeed");else return h.init.apply(this,arguments)}})(jQuery);