// jquery.kyco.googleplusfeed brought to you by www.kyco.co.za. Copyright 2013 Cornelius Weidmann. Distributed under the GPL.
(function(a){var q={init:function(e){var b=a.extend({},{feedLoaderClass:"feed_loader",feedWrapperClass:"feed_wrapper",feedHeaderClass:"feed_header",feedScreenNameClass:"feed_screen_name",feedProfileImageClass:"feed_profile_image",feedContentClass:"feed_content",feedPostsContentClass:"feed_post",feedShowMoreClass:"feed_sow_more",feedPosts:3,feedIncrement:3,feedMax:20,imgSize:50},e);return this.each(function(){function e(){var a=k.entries,d=a.length,l=0,f=!1,m=0,h=b.feedPosts,c="";if(0<a.length){for(m;m< b.feedPosts;m++)c+='<div class="'+b.feedPostsContentClass+" post_"+(m+1)+'">',c+="<span>Shared publicly - "+a[m].publishedDate.substr(0,16)+"</span>",c+="<p>"+a[m].contentSnippet+"</p>",c+='<a href="'+a[m].link+'" target="_blank">View post</a>',c+="</div>";t.html('<a href="'+k.url+'" target="_blank">'+k.screenName+"</a>");s.attr("href",k.url);s.append('<img src="'+k.image+'" />');p.html(c);p.animate({scrollTop:0},1);g.fadeIn(300);r.click(function(){if(l<=d){l+=f?b.feedIncrement:b.feedPosts+b.feedIncrement; l=l>d?d:l;for(h;h<l;h++)c+='<div class="'+b.feedPostsContentClass+" post_"+(h+1)+'">',c+="<span>Shared publicly - "+a[h].publishedDate.substr(0,16)+"</span>",c+="<p>"+a[h].contentSnippet+"</p>",c+='<a href="'+a[h].link+'" target="_blank">View post</a>',c+="</div>",h===d-1&&(r.unbind("click").addClass("link"),r.text("View more posts on Google+").click(function(){window.open(k.url)}));p.animate({scrollTop:p[0].scrollHeight},500);f=!0}p.html(c)})}else console.log("Nothing to show. Empty feed."),g.children().remove(), g.fadeIn(300),g.html('<div class="error">Nothing to show. Empty feed. <span class="retry">Refresh</span></div>'),g.find(".retry").click(function(){g.children().remove();g.append(n);n.show();k.getFeed()})}var f=a(this),u=a('<div id="feed_for_'+f.attr("class")+'"class="kyco_googleplusfeed"></div>'),n=a('<div class="'+b.feedLoaderClass+'">Loading...</div>'),g=a('<div class="'+b.feedWrapperClass+'"></div>'),q=a('<div class="'+b.feedHeaderClass+'"></div>'),t=a('<h3 class="'+b.feedScreenNameClass+'"></h3>'), s=a('<a href="#" class="'+b.feedProfileImageClass+'" target="_blank"></a>'),p=a('<div class="'+b.feedContentClass+'"></div>'),r=a('<span class="'+b.feedShowMoreClass+'">Show more</span>');q.append(s,t);g.append(q,p,r);u.append(n,g);f.append(u);var k=new function(f){var d=this;d.id=f;d.image="https://plus.google.com/s2/photos/profile/"+d.id+"?sz="+b.imgSize;d.url="https://plus.google.com/"+d.id;d.init=function(){e()};d.getFeed=function(){a.ajax({url:"http://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num="+ b.feedMax+"&callback=?&q="+encodeURIComponent("http://plusfeed.frosas.net/"+d.id),dataType:"json",success:function(b){console.log(b);try{var f=b.responseData.feed.title;d.screenName=f.substr(0,f.indexOf("@")-1);d.entries=b.responseData.feed.entries;d.entries.forEach(function(b){b.contentSnippet=a(b.content).first().html()});d.raw=b;a('<img src="'+d.image+'"/>').load(function(){n.fadeOut(300,function(){a(this).remove();d.init()})})}catch(e){console.log("Unable to retrieve feed contents.",e),n.fadeOut(300, function(){a(this).remove();g.fadeIn(300);g.html('<div class="error">Unable to retrieve feed contents. <span class="retry">Retry</span></div>');g.find(".retry").click(function(){g.children().remove();g.append(n);n.show();d.getFeed()})})}}})};d.getFeed()}(b.id)})}};a.fn.kycoGooglePlusFeed=function(e){"forEach"in Array.prototype||(Array.prototype.forEach=function(b,a){for(var f=0,e=this.length;f<e;f++)f in this&&b.call(a,this[f],f,this)});"string"===typeof e&&(e={id:e});if(q[e])return q[e].apply(this, Array.prototype.slice.call(arguments,1));if("object"!==typeof e&&e)a.error("Method "+e+" does not exist on jQuery.kycoGooglePlusFeed");else return q.init.apply(this,arguments)}})(jQuery);