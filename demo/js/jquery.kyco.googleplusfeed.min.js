// jquery.kyco.googleplusfeed v1.0.2 brought to you by http://www.kyco.co.za. Copyright 2013 Cornelius Weidmann. Distributed under the GPL.
(function(c){var f={init:function(a){var r=c.extend({},{feedPosts:3,postsIncrement:3,maxPosts:20,profileImageSize:50},a);return this.each(function(){function a(){function c(d){var a;a=""+('<div class="feed_post post_'+(d+1)+'">')+("<span>Shared publicly - "+b[d].publishedDate.substr(0,16)+"</span>");a+="<p>"+b[d].contentSnippet+"</p>";a+='<a href="'+b[d].link+'" target="_blank">View post</a>';return a+="</div>"}var b=h.entries,k=b.length,m=r.feedPosts,e=r.postsIncrement,l=0,f=!1,q=0,s=m,n="",m=k< m?k:m;if(0<k){for(;q<m;q++)n+=c(q);v.html('<a href="'+h.url+'" target="_blank">'+h.screenName+"</a>");u.attr("href",h.url);u.append('<img src="'+h.image+'">');p.html(n);p.animate({scrollTop:0},1);d.fadeIn(300)}else d.children().remove(),d.html('<div class="error">Nothing to show. Empty feed. <span class="retry">Refresh</span></div>'),d.fadeIn(300),d.find(".retry").click(function(){d.children().remove();d.append(g);g.show();h.getFeed()});t.click(function(){if(l<=k){l+=f?e:m+e;for(l=l>k?k:l;s<l;s++)n+= c(s),s===k-1&&(t.unbind("click").addClass("link"),t.text("View more posts on Google+").click(function(){window.open(h.url)}));p.animate({scrollTop:p[0].scrollHeight},500);f=!0}p.html(n)})}var e=c(this),q=c('<div id="feed_'+e.attr("class")+'" class="kyco_googleplusfeed"></div>'),g=c('<div class="feed_loader">Loading...</div>'),d=c('<div class="feed_wrapper"></div>'),f=c('<div class="feed_header"></div>'),v=c('<h3 class="feed_screen_name"></h3>'),u=c('<a href="#" class="feed_profile_image" target="_blank"></a>'), p=c('<div class="feed_content"></div>'),t=c('<span class="feed_sow_more">Show more</span>');f.append(u,v);d.append(f,p,t);q.append(g,d);e.append(q);var h=new function(e){var b=this;b.id=e;b.image="https://plus.google.com/s2/photos/profile/"+b.id+"?sz="+r.profileImageSize;b.url="https://plus.google.com/"+b.id;b.init=function(){a()};b.getFeed=function(){c.ajax({url:"http://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num="+r.maxPosts+"&callback=?&q="+encodeURIComponent("http://plusfeed.frosas.net/"+ b.id),dataType:"json",success:function(a){try{b.raw=a;var e=a.responseData.feed.title;b.screenName=e.substr(0,e.indexOf("@")-1);b.entries=a.responseData.feed.entries;b.entries.forEach(function(a){a.contentSnippet=c(a.content).first().html()});c('<img src="'+b.image+'">').load(function(){g.fadeOut(300,function(){g.remove();b.init()})})}catch(f){g.fadeOut(300,function(){g.remove();d.html('<div class="error">Unable to retrieve feed contents. <span class="retry">Retry</span></div>');d.fadeIn(300);d.find(".retry").click(function(){d.children().remove(); d.append(g);g.show();b.getFeed()})})}}})};b.getFeed()}(r.id)})}};c.fn.kycoGooglePlusFeed=function(a){"forEach"in Array.prototype||(Array.prototype.forEach=function(a,c){for(var e=0,f=this.length;e<f;e++)e in this&&a.call(c,this[e],e,this)});"string"===typeof a&&(a={id:a});if(f[a])return f[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof a&&a)c.error("Method "+a+" does not exist on jQuery.kycoGooglePlusFeed");else return f.init.apply(this,arguments)}})(jQuery);
