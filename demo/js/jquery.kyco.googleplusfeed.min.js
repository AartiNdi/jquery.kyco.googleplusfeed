// jquery.kyco.googleplusfeed v1.0.2 brought to you by http://www.kyco.co.za. Copyright 2013 Cornelius Weidmann. Distributed under the GPL.
(function(b){var f={init:function(a){var s=b.extend({},{feedPosts:3,postsIncrement:3,maxPosts:20,profileImageSize:50},a);return this.each(function(){function a(){function b(d){var a;a=""+('<div class="feed_post post_'+(d+1)+'">')+("<span>Shared publicly - "+c[d].publishedDate.substr(0,16)+"</span>");a+="<p>"+c[d].contentSnippet+"</p>";a+='<a href="'+c[d].link+'" target="_blank">View post</a>';return a+="</div>"}var c=h.entries,k=c.length,m=s.feedPosts,e=s.postsIncrement,l=0,f=!1,r=0,t=m,n="",m=k< m?k:m;if(0<k){for(;r<m;r++)n+=b(r);x.children("a").attr("href",h.url).text(h.screenName);w.attr("href",h.url);w.append('<img src="'+h.image+'">');p.html(n);p.animate({scrollTop:0},1);d.fadeIn(300)}else d.children().remove(),q.text("Nothing to show. Empty feed. "),u.text("Refresh"),q.append(u),d.append(q),d.fadeIn(300),d.find(".retry").click(function(){d.children().remove();d.append(g);g.show();h.getFeed()});v.click(function(){if(l<=k){l+=f?e:m+e;for(l=l>k?k:l;t<l;t++)n+=b(t),t===k-1&&(v.unbind("click").addClass("link"), v.text("View more posts on Google+").click(function(){window.open(h.url)}));p.animate({scrollTop:p[0].scrollHeight},500);f=!0}p.html(n)})}var e=b(this),r=b('<div id="feed_'+e.attr("class")+'" class="kyco_googleplusfeed"></div>'),g=b('<div class="feed_loader">Loading...</div>'),d=b('<div class="feed_wrapper"></div>'),f=b('<div class="feed_header"></div>'),x=b('<h3 class="feed_screen_name"><a href="#" target="_blank"></a></h3>'),w=b('<a href="#" class="feed_profile_image" target="_blank"></a>'),p=b('<div class="feed_content"></div>'), v=b('<span class="feed_sow_more">Show more</span>'),q=b('<div class="error"></div>'),u=b('<span class="retry"></span>');f.append(w,x);d.append(f,p,v);r.append(g,d);e.append(r);var h=new function(e){var c=this;c.id=e;c.image="https://plus.google.com/s2/photos/profile/"+c.id+"?sz="+s.profileImageSize;c.url="https://plus.google.com/"+c.id;c.init=function(){a()};c.getFeed=function(){b.ajax({url:"http://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num="+s.maxPosts+"&callback=?&q="+encodeURIComponent("http://plusfeed.frosas.net/"+ c.id),dataType:"json",success:function(a){try{c.raw=a;var e=a.responseData.feed.title;c.screenName=e.substr(0,e.indexOf("@")-1);c.entries=a.responseData.feed.entries;c.entries.forEach(function(a){a.contentSnippet=b(a.content).first().html()});b('<img src="'+c.image+'">').load(function(){g.fadeOut(300,function(){g.remove();c.init()})})}catch(f){g.fadeOut(300,function(){d.children().remove();q.text("Unable to retrieve feed contents. ");u.text("Retry");q.append(u);d.append(q);d.fadeIn(300);d.find(".retry").click(function(){d.children().remove(); d.append(g);g.show();c.getFeed()})})}}})};c.getFeed()}(s.id)})}};b.fn.kycoGooglePlusFeed=function(a){"forEach"in Array.prototype||(Array.prototype.forEach=function(a,b){for(var e=0,f=this.length;e<f;e++)e in this&&a.call(b,this[e],e,this)});"string"===typeof a&&(a={id:a});if(f[a])return f[a].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof a&&a)b.error("Method "+a+" does not exist on jQuery.kycoGooglePlusFeed");else return f.init.apply(this,arguments)}})(jQuery);
