// jquery.kyco.googleplusfeed v1.0.1 brought to you by http://www.kyco.co.za. Copyright 2013 Cornelius Weidmann. Distributed under the GPL.
(function(c){var f={init:function(e){var n=c.extend({},{feedPosts:3,postsIncrement:3,maxPosts:20,profileImageSize:50},e);return this.each(function(){function e(){function c(a){var b;b=""+('<div class="feed_post post_'+(a+1)+'">')+("<span>Shared publicly - "+d[a].publishedDate.substr(0,16)+"</span>");b+="<p>"+d[a].contentSnippet+"</p>";b+='<a href="'+d[a].link+'" target="_blank">View post</a>';return b+="</div>"}var a=n.feedPosts,d=h.entries,p=d.length,f=n.postsIncrement,k=0,q=!1,t=0,r=a,l="";if(0< p){for(;t<a;t++)l+=c(t);v.html('<a href="'+h.url+'" target="_blank">'+h.screenName+"</a>");u.attr("href",h.url);u.append('<img src="'+h.image+'">');m.html(l);m.animate({scrollTop:0},1);b.fadeIn(300)}else b.children().remove(),b.html('<div class="error">Nothing to show. Empty feed. <span class="retry">Refresh</span></div>'),b.fadeIn(300),b.find(".retry").click(function(){b.children().remove();b.append(g);g.show();h.getFeed()});s.click(function(){if(k<=p){k+=q?f:a+f;for(k=k>p?p:k;r<k;r++)l+=c(r),r=== p-1&&(s.unbind("click").addClass("link"),s.text("View more posts on Google+").click(function(){window.open(h.url)}));m.animate({scrollTop:m[0].scrollHeight},500);q=!0}m.html(l)})}var d=c(this),q=c('<div id="feed_'+d.attr("class")+'" class="kyco_googleplusfeed"></div>'),g=c('<div class="feed_loader">Loading...</div>'),b=c('<div class="feed_wrapper"></div>'),f=c('<div class="feed_header"></div>'),v=c('<h3 class="feed_screen_name"></h3>'),u=c('<a href="#" class="feed_profile_image" target="_blank"></a>'), m=c('<div class="feed_content"></div>'),s=c('<span class="feed_sow_more">Show more</span>');f.append(u,v);b.append(f,m,s);q.append(g,b);d.append(q);var h=new function(d){var a=this;a.id=d;a.image="https://plus.google.com/s2/photos/profile/"+a.id+"?sz="+n.profileImageSize;a.url="https://plus.google.com/"+a.id;a.init=function(){e()};a.getFeed=function(){c.ajax({url:"http://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num="+n.maxPosts+"&callback=?&q="+encodeURIComponent("http://plusfeed.frosas.net/"+ a.id),dataType:"json",success:function(d){try{a.raw=d;var e=d.responseData.feed.title;a.screenName=e.substr(0,e.indexOf("@")-1);a.entries=d.responseData.feed.entries;a.entries.forEach(function(a){a.contentSnippet=c(a.content).first().html()});c('<img src="'+a.image+'">').load(function(){g.fadeOut(300,function(){g.remove();a.init()})})}catch(f){g.fadeOut(300,function(){g.remove();b.html('<div class="error">Unable to retrieve feed contents. <span class="retry">Retry</span></div>');b.fadeIn(300);b.find(".retry").click(function(){b.children().remove(); b.append(g);g.show();a.getFeed()})})}}})};a.getFeed()}(n.id)})}};c.fn.kycoGooglePlusFeed=function(e){"forEach"in Array.prototype||(Array.prototype.forEach=function(c,e){for(var d=0,f=this.length;d<f;d++)d in this&&c.call(e,this[d],d,this)});"string"===typeof e&&(e={id:e});if(f[e])return f[e].apply(this,Array.prototype.slice.call(arguments,1));if("object"!==typeof e&&e)c.error("Method "+e+" does not exist on jQuery.kycoGooglePlusFeed");else return f.init.apply(this,arguments)}})(jQuery);
